<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Notepad</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #ffffff;
            display: flex;
            flex-direction: column;
        }

        .top-bar {
            height: 52px;
            background: #ffffff;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            flex-shrink: 0;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .logo-icon svg {
            width: 18px;
            height: 18px;
        }

        .logo-text {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1f2937;
        }

        .time-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .live-clock {
            display: flex;
            align-items: center;
            gap: 12px;
            background: #f3f4f6;
            padding: 8px 16px;
            border-radius: 10px;
        }

        .clock-time {
            font-size: 1.5rem;
            font-weight: 700;
            color: #6366f1;
            font-variant-numeric: tabular-nums;
            letter-spacing: 0.5px;
        }

        .clock-date {
            font-size: 0.8rem;
            color: #6b7280;
            border-left: 1px solid #d1d5db;
            padding-left: 12px;
        }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: #10b981;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .live-dot {
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.3); }
        }

        .toolbar {
            height: 48px;
            background: #fafafa;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            padding: 0 20px;
            gap: 6px;
            flex-shrink: 0;
        }

        .tool-btn {
            height: 34px;
            padding: 0 14px;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: 'Inter', sans-serif;
        }

        .tool-btn:hover {
            background: #6366f1;
            color: #ffffff;
            border-color: #6366f1;
        }

        .tool-btn svg {
            width: 14px;
            height: 14px;
        }

        .tool-divider {
            width: 1px;
            height: 24px;
            background: #e5e7eb;
            margin: 0 8px;
        }

        .tool-btn.primary {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
        }

        .tool-btn.primary:hover {
            background: #4f46e5;
        }

        .main-area {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #ffffff;
            position: relative;
        }

        .math-canvas {
            flex: 1;
            display: block;
            padding: 30px;
            cursor: text;
            overflow: auto;
            padding-bottom: 220px;
        }

        .math-line {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 15px;
        }

        .line-indicator {
            color: #6366f1;
            font-weight: 600;
            font-size: inherit;
            user-select: none;
            flex-shrink: 0;
            padding-top: 2px;
        }

        .math-line-field {
            flex: 1;
        }

        #math-field {
            font-size: 2rem;
            min-height: 100%;
            width: 100%;
            max-width: 100%;
        }

        #math-field .mq-editable-field {
            border: none !important;
            box-shadow: none !important;
            outline: none !important;
        }

        .mq-editable-field {
            border: none !important;
            box-shadow: none !important;
            outline: none !important;
        }

        .mq-focused {
            border: none !important;
            box-shadow: none !important;
            outline: none !important;
        }

        .history-panel {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            border-top: 1px solid #e5e7eb;
            max-height: 200px;
            overflow-y: auto;
            padding: 15px 20px;
        }

        .history-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .history-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.7rem;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .history-title svg {
            width: 14px;
            height: 14px;
        }

        .history-count {
            font-size: 0.7rem;
            color: #9ca3af;
            background: #f3f4f6;
            padding: 4px 10px;
            border-radius: 20px;
        }

        .history-grid {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .history-card {
            padding: 12px 16px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.15s ease;
        }

        .history-card:hover {
            border-color: #6366f1;
            background: #faf5ff;
        }

        .history-card-content {
            font-size: 1rem;
        }

        .history-card-meta {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .history-card-time {
            font-size: 0.65rem;
            color: #9ca3af;
        }

        .history-card-delete {
            background: none;
            border: none;
            color: #d1d5db;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .history-card-delete:hover {
            background: #fee2e2;
            color: #ef4444;
        }

        .history-card-delete svg {
            width: 12px;
            height: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #9ca3af;
            width: 100%;
        }

        .empty-state svg {
            width: 32px;
            height: 32px;
            margin-bottom: 8px;
            opacity: 0.4;
        }

        .empty-state p {
            font-size: 0.8rem;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: #ffffff;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1f2937;
        }

        .modal-close {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .modal-close svg {
            width: 20px;
            height: 20px;
        }

        .modal-body {
            padding: 24px;
        }

        .notes-textarea {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            line-height: 1.8;
            resize: vertical;
            transition: all 0.2s ease;
            background: #ffffff;
            color: #1f2937;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        .notes-textarea::placeholder {
            color: #9ca3af;
        }

        .status-bar {
            height: 28px;
            background: #fafafa;
            border-top: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            font-size: 0.7rem;
            color: #9ca3af;
            flex-shrink: 0;
        }

        .status-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .kbd {
            background: #e5e7eb;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.65rem;
        }

        .zoom-display {
            font-size: 0.8rem;
            font-weight: 500;
            color: #374151;
            min-width: 45px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="logo-section">
            <div class="logo-icon">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                </svg>
            </div>
            <span class="logo-text">Math Notepad</span>
        </div>
        <div class="time-section">
            <div class="live-clock">
                <div class="clock-time" id="current-time">00:00:00</div>
                <div class="clock-date" id="current-date">Loading...</div>
            </div>
            <div class="live-badge">
                <span class="live-dot"></span>
                Live
            </div>
        </div>
    </div>

    <div class="toolbar">
        <button class="tool-btn" onclick="insertSymbol('\\\\frac{}{}')">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" /></svg>
            Fraction
        </button>
        <button class="tool-btn" onclick="insertSymbol('\\\\sqrt{}')">√ Root</button>
        <button class="tool-btn" onclick="insertSymbol('^{}')">x² Power</button>
        <button class="tool-btn" onclick="insertSymbol('_{}')">x₁ Subscript</button>
        <div class="tool-divider"></div>
        <button class="tool-btn" onclick="insertSymbol('\\\\pi')">π</button>
        <button class="tool-btn" onclick="insertSymbol('\\\\theta')">θ</button>
        <button class="tool-btn" onclick="insertSymbol('\\\\alpha')">α</button>
        <button class="tool-btn" onclick="insertSymbol('\\\\beta')">β</button>
        <div class="tool-divider"></div>
        <button class="tool-btn" onclick="insertSymbol('\\\\sum')">Σ</button>
        <button class="tool-btn" onclick="insertSymbol('\\\\int')">∫</button>
        <button class="tool-btn" onclick="insertSymbol('\\\\infty')">∞</button>
        <button class="tool-btn" onclick="insertSymbol('\\\\pm')">±</button>
        <div class="tool-divider"></div>
        <button class="tool-btn primary" onclick="saveExpression()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
            Save
        </button>
        <button class="tool-btn" onclick="clearField()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
            Clear
        </button>
        <div class="tool-divider"></div>
        <button class="tool-btn" onclick="zoomOut()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" /></svg>
        </button>
        <span class="zoom-display" id="zoom-display">100%</span>
        <button class="tool-btn" onclick="zoomIn()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
        </button>
        <div class="tool-divider"></div>
        <button class="tool-btn" onclick="openNotesModal()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
            Notes
        </button>
    </div>

    <div class="main-area">
        <div class="canvas-area">
            <div class="math-canvas" id="math-canvas" onclick="focusMathField()">
            </div>

            <div class="history-panel">
                <div class="history-header">
                    <div class="history-title">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        Saved Expressions
                    </div>
                    <span class="history-count" id="history-count">0 items</span>
                </div>
                <div class="history-grid" id="history-list">
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg>
                        <p>No saved expressions yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="notes-modal" onclick="closeNotesModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <span class="modal-title">Notes</span>
                <button class="modal-close" onclick="closeNotesModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div class="modal-body">
                <textarea class="notes-textarea" id="notes-textarea" placeholder="Write your notes here..."></textarea>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <div class="status-left">
            <span class="status-item"><span class="kbd">Enter</span> New line</span>
            <span class="status-item"><span class="kbd">Ctrl+S</span> Save</span>
        </div>
        <div>Math Notepad v1.0</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathquill/0.10.1/mathquill.min.js"></script>
    <script>
        var MQ = MathQuill.getInterface(2);
        var mathFields = [];
        var currentFieldIndex = 0;
        var history = [];
        var fontSize = 2;
        var minFontSize = 1;
        var maxFontSize = 4;

        document.addEventListener('DOMContentLoaded', function() {
            addNewLine();
            updateTime();
            setInterval(updateTime, 1000);
            loadHistory();

            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    saveExpression();
                }
            });
        });

        function addNewLine() {
            var canvas = document.getElementById('math-canvas');
            var lineDiv = document.createElement('div');
            lineDiv.className = 'math-line';
            var lineIndex = mathFields.length;
            
            var indicator = document.createElement('span');
            indicator.className = 'line-indicator';
            indicator.textContent = lineIndex === 0 ? '' : '=>';
            indicator.style.fontSize = fontSize + 'rem';
            
            var fieldSpan = document.createElement('span');
            fieldSpan.className = 'math-line-field';
            fieldSpan.id = 'math-field-' + lineIndex;
            fieldSpan.style.fontSize = fontSize + 'rem';
            
            lineDiv.appendChild(indicator);
            lineDiv.appendChild(fieldSpan);
            canvas.appendChild(lineDiv);
            
            var field = MQ.MathField(fieldSpan, {
                spaceBehavesLikeTab: true,
                handlers: {
                    enter: function() {
                        addNewLine();
                    },
                    deleteOutOf: function(dir, field) {
                        if (dir === MQ.L) {
                            removeLine(lineIndex);
                        }
                    }
                }
            });
            
            fieldSpan.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && field.latex() === '' && lineIndex > 0) {
                    e.preventDefault();
                    removeLine(lineIndex);
                }
            });
            
            mathFields.push({ field: field, element: fieldSpan, indicator: indicator, lineDiv: lineDiv });
            currentFieldIndex = lineIndex;
            field.focus();
            
            canvas.scrollTop = canvas.scrollHeight;
        }

        function removeLine(index) {
            if (index <= 0 || index >= mathFields.length) return;
            
            var item = mathFields[index];
            item.lineDiv.remove();
            mathFields.splice(index, 1);
            
            for (var i = index; i < mathFields.length; i++) {
                mathFields[i].element.id = 'math-field-' + i;
            }
            
            currentFieldIndex = index - 1;
            mathFields[currentFieldIndex].field.focus();
        }

        function updateTime() {
            var now = new Date();
            var hours = String(now.getHours()).padStart(2, '0');
            var minutes = String(now.getMinutes()).padStart(2, '0');
            var seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('current-time').textContent = hours + ':' + minutes + ':' + seconds;

            var options = { weekday: 'short', month: 'short', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('en-US', options);
        }

        function insertSymbol(symbol) {
            if (mathFields.length > 0) {
                mathFields[currentFieldIndex].field.cmd(symbol);
                mathFields[currentFieldIndex].field.focus();
            }
        }

        function zoomIn() {
            if (fontSize < maxFontSize) {
                fontSize += 0.25;
                updateZoom();
            }
        }

        function zoomOut() {
            if (fontSize > minFontSize) {
                fontSize -= 0.25;
                updateZoom();
            }
        }

        function updateZoom() {
            var percent = Math.round((fontSize / 2) * 100);
            document.getElementById('zoom-display').textContent = percent + '%';
            mathFields.forEach(function(item) {
                item.element.style.fontSize = fontSize + 'rem';
                item.indicator.style.fontSize = fontSize + 'rem';
            });
        }

        function saveExpression() {
            var allLatex = mathFields.map(function(item) {
                return item.field.latex();
            }).filter(function(l) { return l.trim() !== ''; }).join(' \\\\newline ');
            
            if (allLatex.trim() === '') return;

            var now = new Date();
            var timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            
            history.unshift({
                latex: allLatex,
                time: timeStr,
                id: Date.now()
            });

            localStorage.setItem('mathHistory', JSON.stringify(history));
            renderHistory();
            clearField();
        }

        function clearField() {
            var canvas = document.getElementById('math-canvas');
            canvas.innerHTML = '';
            mathFields = [];
            addNewLine();
        }

        function focusMathField() {
            if (mathFields.length > 0) {
                mathFields[currentFieldIndex].field.focus();
            }
        }

        function openNotesModal() {
            document.getElementById('notes-modal').classList.add('active');
            document.getElementById('notes-textarea').focus();
        }

        function closeNotesModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('notes-modal').classList.remove('active');
            localStorage.setItem('mathNotes', document.getElementById('notes-textarea').value);
        }

        function loadHistory() {
            var saved = localStorage.getItem('mathHistory');
            if (saved) {
                history = JSON.parse(saved);
                renderHistory();
            }
            var notes = localStorage.getItem('mathNotes');
            if (notes) {
                document.getElementById('notes-textarea').value = notes;
            }
        }

        function renderHistory() {
            var container = document.getElementById('history-list');
            var countEl = document.getElementById('history-count');
            
            countEl.textContent = history.length + ' item' + (history.length !== 1 ? 's' : '');
            
            if (history.length === 0) {
                container.innerHTML = '<div class="empty-state"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" /></svg><p>No saved expressions yet</p></div>';
                return;
            }

            container.innerHTML = '';
            history.forEach(function(item) {
                var div = document.createElement('div');
                div.className = 'history-card';
                div.innerHTML = '<span class="history-card-content" id="expr-' + item.id + '"></span><div class="history-card-meta"><span class="history-card-time">' + item.time + '</span><button class="history-card-delete" onclick="deleteExpression(' + item.id + ')"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div>';
                container.appendChild(div);
                
                var exprSpan = document.getElementById('expr-' + item.id);
                MQ.StaticMath(exprSpan).latex(item.latex);
            });
        }

        function deleteExpression(id) {
            history = history.filter(function(item) {
                return item.id !== id;
            });
            localStorage.setItem('mathHistory', JSON.stringify(history));
            renderHistory();
        }
    </script>
</body>
</html>
